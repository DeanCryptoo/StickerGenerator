<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Memeportal â€” Emoji / Spinner (beta)</title>
<link rel="stylesheet" href="style.css" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
</head>
<body>
  <div id="site-header"></div>
  <script>/* load shared nav */(async()=>{try{const r=await fetch('nav.html');document.getElementById('site-header').innerHTML=await r.text();}catch(e){console.warn('nav load failed',e);}})();</script>

  <main style="max-width:1100px;margin:20px auto;display:grid;grid-template-columns:380px 1fr;gap:16px;height:calc(100vh - var(--header-h));overflow:hidden">
    <aside class="card section" style="overflow:auto">
      <h2>Coin Settings</h2>
      <div class="grid">
        <div>
          <label>Logo (PNG/SVG)</label>
          <input id="logoFile" type="file" accept="image/*,image/svg+xml">
          <div class="tiny muted">Tip: transparent PNG logo looks best.</div>
        </div>
        <div class="two">
          <div>
            <label for="coinA">Coin color A</label>
            <input id="coinA" type="color" value="#f59e0b"/>
          </div>
          <div>
            <label for="coinB">Coin color B</label>
            <input id="coinB" type="color" value="#fde68a"/>
          </div>
        </div>
        <div class="two">
          <div>
            <label for="edge">Edge width</label>
            <input id="edge" type="range" min="2" max="20" value="8">
          </div>
          <div>
            <label for="speed">Spin speed</label>
            <input id="speed" type="range" min="0.2" max="3" step="0.1" value="1.2">
          </div>
        </div>
        <div class="two">
          <div>
            <label for="size">Size</label>
            <select id="size">
              <option>128</option>
              <option selected>256</option>
              <option>512</option>
            </select>
          </div>
          <div class="flex">
            <input id="shine" type="checkbox" checked>
            <label for="shine" style="margin:0">Specular shine</label>
          </div>
        </div>
        <div class="toolbar">
          <button class="btn" id="exportFrames">Export frames (ZIP)</button>
        </div>
        <div class="tiny muted">Exports 24 frames PNG (good for Discord/TG animated stickers when converted).</div>
      </div>
    </aside>

    <section class="card section" style="display:grid;gap:10px;overflow:auto">
      <h2>Preview</h2>
      <canvas id="canvas" width="256" height="256" class="checkerboard" style="width:100%;max-width:520px;border-radius:12px;justify-self:start"></canvas>
    </section>
  </main>

<script>
(function(){
  const canvas = document.getElementById('canvas');
  const ctx = canvas.getContext('2d');
  const logoFile = document.getElementById('logoFile');
  const coinA = document.getElementById('coinA');
  const coinB = document.getElementById('coinB');
  const edge = document.getElementById('edge');
  const speed = document.getElementById('speed');
  const sizeSel = document.getElementById('size');
  const shine = document.getElementById('shine');
  const exportBtn = document.getElementById('exportFrames');

  let logo = null; let t = 0; let last = 0;

  function resize(){ const s=parseInt(sizeSel.value,10); canvas.width=s; canvas.height=s; }
  sizeSel.addEventListener('change', resize); resize();

  logoFile.addEventListener('change', ()=>{ const f = logoFile.files[0]; if(!f) return; const img = new Image(); img.onload=()=>{logo = img}; img.src = URL.createObjectURL(f); });

  function draw(){
    const w = canvas.width, h = canvas.height; ctx.clearRect(0,0,w,h);
    const radius = Math.min(w,h)*0.34; const cx = w/2, cy = h/2; const phase = t; const scaleX = Math.cos(phase); const absX = Math.abs(scaleX);
    const edgeW = +edge.value;
    ctx.save(); ctx.translate(cx, cy); ctx.scale(scaleX, 1);
    const grd = ctx.createRadialGradient(0, -radius*0.4, radius*0.2, 0, 0, radius*1.2); grd.addColorStop(0, coinB.value); grd.addColorStop(1, coinA.value); ctx.fillStyle = grd; ctx.beginPath(); ctx.ellipse(0,0,radius,radius,0,0,Math.PI*2); ctx.fill();
    ctx.lineWidth = edgeW; ctx.strokeStyle = '#00000022'; ctx.stroke();
    if(shine.checked){ const shineGrd = ctx.createLinearGradient(-radius, -radius, radius, radius); shineGrd.addColorStop(0, 'rgba(255,255,255,0.25)'); shineGrd.addColorStop(0.5, 'rgba(255,255,255,0)'); shineGrd.addColorStop(1, 'rgba(0,0,0,0.15)'); ctx.globalCompositeOperation = 'lighter'; ctx.fillStyle = shineGrd; ctx.beginPath(); ctx.ellipse(0,0,radius,radius,0,0,Math.PI*2); ctx.fill(); ctx.globalCompositeOperation = 'source-over'; }
    if(logo){ ctx.save(); const s = radius*1.1; ctx.globalAlpha = absX; if(scaleX < 0){ ctx.scale(-1,1); } const r = Math.min(s, s* (logo.height/logo.width)); const wL = r; const hL = r * (logo.height/logo.width); ctx.drawImage(logo, -wL/2, -hL/2, wL, hL); ctx.restore(); }
    ctx.restore();
  }

  function loop(now){ const dt = (now-last)||16; last = now; t += dt/1000 * +speed.value; draw(); requestAnimationFrame(loop);} requestAnimationFrame(loop);

  exportBtn.addEventListener('click', async ()=>{ const frames = 24; const oldT = t; const zip = new JSZip(); for(let i=0;i<frames;i++){ t = i * (Math.PI*2/frames); draw(); const blob = await new Promise(res=>canvas.toBlob(res,'image/png')); zip.file(`frame_${String(i).padStart(2,'0')}.png`, blob);} t = oldT; const content = await zip.generateAsync({type:'blob'}); const a = document.createElement('a'); a.href = URL.createObjectURL(content); a.download = 'emoji_spinner_frames.zip'; a.click(); });
})();
</script>
</body>
</html>
